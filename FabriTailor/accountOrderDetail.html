<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta name="viewport" content="user-scalable=no, initial-scale=1, maximum-scale=1, minimum-scale=1, width=device-width, height=device-height" />
    <meta name="apple-mobile-web-app-capable" content="yes">
    <title>FabriTailor</title>
    <link href="css/animate.css" rel="stylesheet" />
    <link href="css/style.css" rel="stylesheet" />
    <link href="css/account.css" rel="stylesheet" />
    <link href="css/accountOrderDetail.css" rel="stylesheet" />
    <script src="js/modernizr.js"></script>
    <script src="js/jquery-1.11.3.min.js"></script>
    <script src="js/jquery.easing.1.3.js"></script>
    <script src="js/jquery.alert.js"></script>
    <script src="js/jquery.cookie.js"></script>
    <script src="js/jquery.lazyload.js"></script>
    <script src="js/common.js"></script>
</head>
<body>
    <header>
        <div class="header-container">
            <a class="menu-btn show-on-small" href="javascript:void(0);"><img src="img/menu-btn.png" /></a>
            <div class="logo">
                <img src="img/logo.png" />
            </div>
            <nav class="hide-on-small">
                <ul>
                    <li><a href="javascript:void(0);"><span>在线定制</span></a></li>
                    <li><a href="javascript:void(0);"><span>关于我们</span></a></li>
                    <li><a href="javascript:void(0);"><span>凡布风尚</span></a></li>
                    <li><a href="javascript:void(0);"><span>休闲衬衫</span></a></li>
                    <li><a href="javascript:void(0);"><span>我们的凡布</span></a></li>
                </ul>
            </nav>
            <div class="btn-group hide-on-small">
                <a href="javascript:void(0);" class="register">从这里开始</a><a href="javascript:void(0);" class="login">登录</a>
            </div>
        </div>
    </header>
    <aside class="show-on-small">
        <a href="javascript:void(0);" class="btn-close"><img src="img/menu-btn-close.png" /></a>
        <ul>
            <li><a href="javascript:void(0);"><span>在线定制</span></a></li>
            <li><a href="javascript:void(0);"><span>关于我们</span></a></li>
            <li><a href="javascript:void(0);"><span>凡布风尚</span></a></li>
            <li><a href="javascript:void(0);"><span>休闲衬衫</span></a></li>
            <li><a href="javascript:void(0);"><span>我们的凡布</span></a></li>
            <li><a class="button" href="javascript:void(0);">从这里开始</a></li>
        </ul>
    </aside>
    <div class="main-container">
        <div class="account-aside">
            <div class="current">我的订单<i class="showhide"></i></div>
            <ul>
                <li><a href="javascript:void(0);">账户信息</a></li>
                <li class="active"><a href="javascript:void(0);">我的订单</a></li>
                <li><a href="javascript:void(0);">我的尺寸</a></li>
                <li><a href="javascript:void(0);">我的板型</a></li>
                <li><a href="javascript:void(0);">分享与学习</a></li>
                <li><a href="javascript:void(0);">地址簿</a></li>
                <li><a href="javascript:void(0);">退换货</a></li>
            </ul>
            <a href="javascript:void(0);" class="sign-out">退出</a>
        </div>
        <div class="account-container">
            <div class="accountOrderDetail">
                <h1>订单 #3EIKD0OGG</h1>
                <p><a href="javascript:void(0);">« 全部订单</a></p>
                <h3>2015年7月30日</h3>
                <div class="products">
                    <div class="product clearfix">
                        <div class="image">
                            <img src="img/product-detail1.jpg" />
                        </div>
                        <div class="detail">
                            <h2>Dalton - Black</h2>
                            <h5>$148.00</h5>
                            <div class="clearfix"></div>
                            <div class="text">black</div>
                            <a class="show-build-info active" href="javascript:void(0);">查看详情<i class="showhide"></i></a>
                            <ul class="build-info active">
                                <li>Monogram</li>
                                <li>Normal</li>
                                <li>Side Pleats</li>
                                <li>Placket</li>
                                <li>No Pocket</li>
                            </ul>
                        </div>
                        <div class="status">
                            Delivered on 04/28/2015
                        </div>
                    </div>
                    <div class="product clearfix">
                        <div class="image">
                            <img src="img/product-detail2.jpg" />
                        </div>
                        <div class="detail">
                            <h2>Dalton - Black</h2>
                            <h5>$148.00</h5>
                            <div class="clearfix"></div>
                            <div class="text">black</div>
                            <a class="show-build-info" href="javascript:void(0);">查看详情<i class="showhide"></i></a>
                            <ul class="build-info">
                                <li>Monogram</li>
                                <li>Normal</li>
                                <li>Side Pleats</li>
                                <li>Placket</li>
                                <li>No Pocket</li>
                            </ul>
                        </div>
                        <div class="status">
                            Delivered on 04/28/2015
                        </div>
                    </div>
                </div>
                <div class="purchase row">
                    <div class="col-md-4 col-sm-12">
                        <h2>支付信息</h2>
                        <div class="order-info">
                            <ul>
                                <li>在线支付</li>
                            </ul>
                            <div class="radio clearfix">
                                <input name="paymentMethod" type="radio" value="alipay" />
                                <span></span>
                                <h4>支付宝</h4>
                                <p>支付宝描述</p>
                            </div>
                            <div class="radio clearfix">
                                <input name="paymentMethod" type="radio" value="weichatpay" />
                                <span></span>
                                <h4>微信</h4>
                            </div>
                            <div class="clearfix">
                                <a class="button disabled" href="javascript:void(0);">付款</a>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-4 col-sm-12">
                        <h2>收货地址</h2>
                        <div class="order-info">
                            <ul>
                                <li>Tian Li</li>
                                <li>8845 166th Avenue NE, #B203</li>
                                <li>redmond, WA98052</li>
                            </ul>
                        </div>
                    </div>
                    <div class="col-md-4 col-sm-12">
                        <h2>总计</h2>
                        <div class="total">
                            <ul>
                                <li class="clearfix">
                                    <span class="left">金额</span>
                                    <span class="right">¥24.00</span>
                                </li>
                                <li class="clearfix">
                                    <span class="left">优惠</span>
                                    <span class="right">¥0.00</span>
                                </li>
                                <li class="clearfix">
                                    <span class="left">返现</span>
                                    <span class="right">¥0.00</span>
                                </li>
                                <li class="clearfix">
                                    <span class="left">运费</span>
                                    <span class="right">¥10.00</span>
                                </li>
                            </ul>
                            <div class="sum clearfix">
                                <span class="left">总额</span>
                                <span class="right">¥34.00</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <footer>
        <div class="contact">
            <h3 class="hide-on-small">与凡布保持联系</h3>
            <div class="input-group hide-on-small">
                <input class="input" type="text" placeholder="请输入您的邮件地址" />
                <a href="javascript:void(0);" class="btn">»</a>
            </div>
            <div class="ico-link text-center-on-small">
                <a href="javascript:void(0);"><img src="img/ico-email.jpg" /></a>
                <a href="javascript:void(0);"><img src="img/ico-weibo.png" /></a>
                <a href="javascript:void(0);"><img src="img/ico-weixin.png" /></a>
                <a href="javascript:void(0);"><img src="img/ico-taobao.png" /></a>
            </div>
        </div>
        <div class="links text-center-on-small">
            <div class="row">
                <div class="col-md-3 col-sm-12">
                    <h6>FabriTailor.com</h6>
                    <ul>
                        <li>
                            <a href="javascript:void(0);">
                                北京市<br />
                                朝阳区<br />
                                夏家园18号楼<br />
                                2091室
                            </a>
                        </li>
                    </ul>
                </div>
                <div class="col-md-3 col-sm-12">
                    <h6>凡布制衣</h6>
                    <ul>
                        <li><a href="javascript:void(0);">关于我们</a></li>
                        <li><a href="javascript:void(0);">人才招聘</a></li>
                        <li><a href="javascript:void(0);">成为凡布量体师</a></li>
                        <li><a href="javascript:void(0);">服务条款</a></li>
                        <li><a href="javascript:void(0);">隐私声明</a></li>
                    </ul>
                </div>
                <div class="col-md-3 col-sm-12">
                    <h6>帮助</h6>
                    <ul>
                        <li><a href="javascript:void(0);">购物指南</a></li>
                        <li><a href="javascript:void(0);">关于量体定制</a></li>
                        <li><a href="javascript:void(0);">常见问题解答</a></li>
                        <li><a href="javascript:void(0);">帮助与支持</a></li>
                        <li><a href="javascript:void(0);">退换货信息</a></li>
                    </ul>
                </div>
                <div class="col-md-3 col-sm-12">
                    <h6>在线商店</h6>
                    <ul>
                        <li><a href="javascript:void(0);">衬衫</a></li>
                        <li><a href="javascript:void(0);">查看全部</a></li>
                    </ul>
                </div>
            </div>
        </div>
        <div class="logo">
            <img src="img/logo-footer.png" />
        </div>
    </footer>
    <div class="login-panel">
        <h2>登录</h2>
        <input class="input" type="text" placeholder="请输入电子邮件地址" />
        <input class="input" type="password" placeholder="请输入密码" />
        <a class="button" href="javascript:void(0);">登陆</a>
        <a href="javascript:void(0);">忘记密码，或立即免费注册成为会员？</a>
    </div>
    <div class="cover-small-black"></div>
    <div class="login-cover-black"></div>
    <script type="text/javascript">
        //侧边栏
        $("header .menu-btn").click(function () {
            $("aside").addClass("opened");
            $("div.cover-small-black").addClass("opened").fadeTo("normal", 0.5, EASING_NAME);
        });
        $("aside .btn-close").click(function () {
            $("aside").removeClass("opened");
            $("div.cover-small-black").fadeTo("normal", 0, EASING_NAME, function () { $(this).removeClass("opened"); });
        });
        //登陆
        var showLogin = function () {
            $(".login-panel").show();
            $("div.login-cover-black").addClass("opened").fadeTo("normal", 0.5, EASING_NAME);
        };
        var hideLogin = function () {
            $(".login-panel").hide();
            $("div.login-cover-black").fadeTo("normal", 0, EASING_NAME, function () { $(this).removeClass("opened"); });
        };
        $("div.login-cover-black").click(hideLogin);
        $("header .btn-group .login").click(showLogin);
    </script>
    <script type="text/javascript">
        //账号导航菜单
        $(".main-container .account-aside .current i.showhide").click(function () {
            $(this).toggleClass("mins");
            $(".main-container .account-aside ul").toggleClass("opened");
        });
    </script>
    <script type="text/javascript">
        var orderId = "${order.sn}",
            $purchase = $(".main-container .purchase"),
            $paymentRadio = $purchase.find(".radio"),
            $btnBuy = $purchase.find(".order-info a.button"),
            $waitPanel = $("body .wait-panel"),
            $waitPanelCover = $("body .wait-cover-black");
        //商品显示隐藏详细信息
        $(".main-container .account-container .accountOrderDetail .products .product a.show-build-info").click(function () {
            $(this).toggleClass("active").next("ul.build-info").toggleClass("active");
        });
        //更改支付方式
        var paymentPluginChange = function () {
            var $radio = $(this).parent(),
                $container = $radio.parent(),
                val = $(this).val();
            if (!$container.data("val") || $container.data("val") != val) {
                $container.data("val", val);
                $btnBuy.removeClass("disabled")
            }
        };
        //进行支付
        var doPayment = function () {
            if ($(this).hasClass("disabled"))
                return;
            var paymentPluginId = $paymentRadio.find("input:checked").val();
            if (paymentPluginId == "alipayDirectPlugin" || paymentPluginId == "alipayWapPlugin") {
                openWindow("${base}/payment/submit.jhtml?paymentPluginId=" + encodeURIComponent(paymentPluginId) + "&sn=" + encodeURIComponent(orderId));
                checkOrderStatus();
                //checkOrderLock();
                $waitPanel.show();
                $waitPanelCover.addClass("opened").fadeTo("normal", 0.5, EASING_NAME);
            }
            else if (paymentPluginId == "tenpayNativePlugin") {
                $waitPanel.children("h2").text("正在生成二维码...");
                $waitPanel.children("a").hide();
                $waitPanel.show();
                $waitPanelCover.addClass("opened").fadeTo("normal", 0.5, EASING_NAME);
                $.ajax({
                    url: "${base}/payment/submitv2.jhtml",
                    type: "GET",
                    data: {
                        paymentPluginId: "tenpayNativePlugin",
                        sn: orderId
                    },
                    dataType: "json",
                    cache: false,
                    success: function (data) {
                        if (data && data.type == "success") {
                            var $qrImg = $("<img />");
                            $qrImg.attr("src", data.content);
                            $waitPanel.children("h2").after($qrImg);
                            $waitPanel.children("h2").text("扫描二维码");
                            $waitPanel.children("a").show();
                            $waitPanel.addClass("qr-code");
                            checkOrderStatus();
                            //checkOrderLock();
                        }
                        else {
                            $waitPanel.children("h2").text("支付遇到了问题");
                            $waitPanel.children("a").first().show().text("重新支付");
                        }
                    },
                    error: function () {
                        $waitPanel.children("h2").text("支付遇到了问题");
                        $waitPanel.children("a").first().show().text("重新支付");
                    }
                });
            }
            else if (paymentPluginId == "tenpayJsapiPlugin") {
                window.location.href = "${base}/payment/code.jhtml?sn=" + encodeURIComponent(orderId);
            }
            else {
                window.location.reload();
            }
        };
        //检测订单状态
        var statusTimer = null,
            lockTimer = null;
        var checkOrderStatus = function () {
            $.ajax({
                url: "${base}/member/order/check_payment.jhtml",
                type: "POST",
                data: { sn: orderId },
                dataType: "json",
                cache: false,
                success: function (data) {
                    if (data) {
                        window.location.reload();
                    }
                }
            }).always(function () {
                statusTimer = setTimeout(checkOrderStatus, 3000);
            });
        };
        var checkOrderLock = function () {
            $.ajax({
                url: "${base}/member/order/lock.jhtml",
                type: "POST",
                data: { sn: orderId },
                dataType: "json",
                cache: false,
                success: function (data) {
                    if (data) {
                        window.location.reload();
                    }
                }
            }).always(function () {
                lockTimer = setTimeout(checkOrderLock, 3000);
            });
        };
        //新页面打开链接
        var openWindow = function (url) {
            window.open(url);
        };
        //支付成功/重试
        var reload = function () {
            window.location.reload();
        };
        //注册事件
        $paymentRadio.find("input").click(paymentPluginChange);
        $btnBuy.click(doPayment);
        $waitPanel.children("a").click(reload);
        //过滤支付方式
        if (isMobile()) {
            $paymentRadio.find("input[value=alipayDirectPlugin]").parent().remove();
            $paymentRadio.find("input[value=tenpayNativePlugin]").parent().remove();
        }
        else {
            $paymentRadio.find("input[value=alipayWapPlugin]").parent().remove();
        }
        if (typeof WeixinJSBridge == "undefined") {
            $paymentRadio.find("input[value=tenpayJsapiPlugin]").parent().addClass("hidden");
            var onWeixinReaddy = function () {
                $paymentRadio.find("input[value=tenpayJsapiPlugin]").parent().removeClass("hidden");
            };
            if (document.addEventListener) {
                document.addEventListener('WeixinJSBridgeReady', onWeixinReaddy, false);
            } else if (document.attachEvent) {
                document.attachEvent('WeixinJSBridgeReady', onWeixinReaddy);
                document.attachEvent('onWeixinJSBridgeReady', onWeixinReaddy);
            }
        }
        if (!checkWeixinPayment()) {
            $paymentRadio.find("input[value=tenpayJsapiPlugin]").parent().off().prop("disabled", true)
                .children("h4").css({ color: "#cccccc" }).end()
                .children("p").css({ color: "red" }).text("需要微信5.0或更高版本");
        }
    </script>
</body>
</html>
