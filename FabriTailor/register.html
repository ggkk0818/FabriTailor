<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta name="viewport" content="user-scalable=no, initial-scale=1, maximum-scale=1, minimum-scale=1, width=device-width, height=device-height" />
    <meta name="apple-mobile-web-app-capable" content="yes">
    <title>注册 - FabriTailor</title>
    <link href="css/style.css" rel="stylesheet" />
    <link href="css/register.css" rel="stylesheet" />
    <script src="js/modernizr.js"></script>
    <script src="js/jquery-1.11.3.min.js"></script>
    <script src="js/jquery.easing.1.3.js"></script>
    <script src="js/jquery.cookie.js"></script>
    <script src="js/jquery.lazyload.js"></script>
    <script src="js/common.js"></script>
</head>
<body>
    <header>
        <div class="header-container">
            <a class="menu-btn show-on-small" href="javascript:void(0);"><img src="img/menu-btn.png" /></a>
            <div class="logo">
                <img src="img/logo.png" />
            </div>
            <nav class="hide-on-small">
                <ul>
                    <li><a href="javascript:void(0);"><span>在线定制</span></a></li>
                    <li><a href="javascript:void(0);"><span>关于我们</span></a></li>
                    <li><a href="javascript:void(0);"><span>凡布风尚</span></a></li>
                    <li><a href="javascript:void(0);"><span>休闲衬衫</span></a></li>
                    <li><a href="javascript:void(0);"><span>我们的凡布</span></a></li>
                </ul>
            </nav>
            <div class="btn-group hide-on-small">
                <a href="javascript:void(0);" class="register">从这里开始</a><a href="javascript:void(0);" class="login">登录</a>
            </div>
        </div>
    </header>
    <aside class="show-on-small">
        <a href="javascript:void(0);" class="btn-close"><img src="img/menu-btn-close.png" /></a>
        <ul>
            <li><a href="javascript:void(0);"><span>在线定制</span></a></li>
            <li><a href="javascript:void(0);"><span>关于我们</span></a></li>
            <li><a href="javascript:void(0);"><span>凡布风尚</span></a></li>
            <li><a href="javascript:void(0);"><span>休闲衬衫</span></a></li>
            <li><a href="javascript:void(0);"><span>我们的凡布</span></a></li>
            <li><a class="button" href="javascript:void(0);">从这里开始</a></li>
        </ul>
    </aside>
    <div class="main-container">
        <h1>以下哪个描述更贴近你自己的感受？</h1>
        <p>点击下面提供的内容选项。你的量体师将为你调整尺寸，以便我们为你制作最合身的衣服。</p>
        <ol>
            <li><a href="javascript:void(0);">1</a></li>
            <li><a href="javascript:void(0);">2</a></li>
            <li><a href="javascript:void(0);">3</a></li>
            <li><a href="javascript:void(0);">4</a></li>
            <li><a href="javascript:void(0);">5</a></li>
            <li><a href="javascript:void(0);">6</a></li>
        </ol>
        <div class="steps">
            <div class="step step1" data-name="穿衣风格">
                <div class="options clearfix">
                    <div class="option" data-value="我不知道怎么穿更合适">
                        <div class="image">
                            <img src="img/register-step1-1.jpg" />
                        </div>
                        <h1>我不知道怎么穿更合适。</h1>
                        <a href="javascript:void(0);">这就是我</a>
                    </div>
                    <div class="option" data-value="我没有时间购物">
                        <div class="image">
                            <img src="img/register-step1-2.jpg" />
                        </div>
                        <h1>我没有时间购物。</h1>
                        <a href="javascript:void(0);">这就是我</a>
                    </div>
                    <div class="option" data-value="我很在意自己的穿着">
                        <div class="image">
                            <img src="img/register-step1-3.jpg" />
                        </div>
                        <h1>我很在意自己的穿着。</h1>
                        <a href="javascript:void(0);">这就是我</a>
                    </div>
                </div>
            </div>
            <div class="step step2" data-show-next-btn="true" data-name="我通常感觉不合适的地方">
                <div class="step-container clearfix">
                    <div class="options">
                        <div class="option" data-name="领口">
                            <h3>衬衫领口</h3>
                            <div class="radio-image">
                                <img src="img/register-step2-2.jpg" />
                            </div>
                            <div class="radio clearfix">
                                <input name="radio1" type="radio" value="tight" />
                                <span></span>
                                <h4>太紧</h4>
                            </div>
                            <div class="radio clearfix">
                                <input name="radio1" type="radio" value="loose" />
                                <span></span>
                                <h4>太松</h4>
                            </div>
                        </div>
                        <div class="option" data-name="袖子">
                            <h3>衬衫袖子</h3>
                            <div class="radio-image">
                                <img src="img/register-step2-3.jpg" />
                            </div>
                            <div class="radio clearfix">
                                <input name="radio2" type="radio" value="short" />
                                <span></span>
                                <h4>太短</h4>
                            </div>
                            <div class="radio clearfix">
                                <input name="radio2" type="radio" value="long" />
                                <span></span>
                                <h4>太长</h4>
                            </div>
                        </div>
                        <div class="option" data-name="袖口">
                            <h3>衬衫袖口</h3>
                            <div class="radio-image">
                                <img src="img/register-step2-4.jpg" />
                            </div>
                            <div class="radio clearfix">
                                <input name="radio3" type="radio" value="tight" />
                                <span></span>
                                <h4>太紧</h4>
                            </div>
                            <div class="radio clearfix">
                                <input name="radio3" type="radio" value="loose" />
                                <span></span>
                                <h4>太松</h4>
                            </div>
                        </div>
                    </div>
                    <div class="image">
                        <img src="img/register-step2-1.jpg" />
                    </div>
                    <div class="options">
                        <div class="option" data-name="胸围">
                            <h3>衬衫胸围</h3>
                            <div class="radio-image">
                                <img src="img/register-step2-5.jpg" />
                            </div>
                            <div class="radio clearfix">
                                <input name="radio4" type="radio" value="tight" />
                                <span></span>
                                <h4>太紧</h4>
                            </div>
                            <div class="radio clearfix">
                                <input name="radio4" type="radio" value="loose" />
                                <span></span>
                                <h4>太松</h4>
                            </div>
                        </div>
                        <div class="option" data-name="腰围">
                            <h3>衬衫腰围</h3>
                            <div class="radio-image">
                                <img src="img/register-step2-6.jpg" />
                            </div>
                            <div class="radio clearfix">
                                <input name="radio5" type="radio" value="tight" />
                                <span></span>
                                <h4>太紧</h4>
                            </div>
                            <div class="radio clearfix">
                                <input name="radio5" type="radio" value="loose" />
                                <span></span>
                                <h4>太松</h4>
                            </div>
                        </div>
                        <div class="option" data-name="衣长">
                            <h3>衬衫衣长</h3>
                            <div class="radio-image">
                                <img src="img/register-step2-7.jpg" />
                            </div>
                            <div class="radio clearfix">
                                <input name="radio6" type="radio" value="short" />
                                <span></span>
                                <h4>太短</h4>
                            </div>
                            <div class="radio clearfix">
                                <input name="radio6" type="radio" value="long" />
                                <span></span>
                                <h4>太长</h4>
                            </div>
                        </div>
                    </div>
                    <div class="option-none">
                        <div class="radio clearfix">
                            <input name="radio-none" type="radio" value="long" />
                            <span></span>
                            <h4>这些都不适用于我</h4>
                        </div>
                    </div>
                </div>
            </div>
            <div class="step step3" data-show-next-btn="true" data-name="我对以下这些东西感兴趣">
                <div class="options clearfix">
                    <div class="option" data-value="休闲衬衫1">
                        <div class="image">
                            <img src="img/register-step3-1.jpg" />
                            <span class="cover"></span>
                        </div>
                        <h4>休闲衬衫1</h4>
                    </div>
                    <div class="option" data-value="正装衬衫1">
                        <div class="image">
                            <img src="img/register-step3-2.jpg" />
                            <span class="cover"></span>
                        </div>
                        <h4>正装衬衫1</h4>
                    </div>
                    <div class="option" data-value="休闲衬衫2">
                        <div class="image">
                            <img src="img/register-step3-3.jpg" />
                            <span class="cover"></span>
                        </div>
                        <h4>休闲衬衫2</h4>
                    </div>
                    <div class="option" data-value="正装衬衫2">
                        <div class="image">
                            <img src="img/register-step3-4.jpg" />
                            <span class="cover"></span>
                        </div>
                        <h4>正装衬衫2</h4>
                    </div>
                    <div class="option" data-value="休闲衬衫3">
                        <div class="image">
                            <img src="img/register-step3-5.jpg" />
                            <span class="cover"></span>
                        </div>
                        <h4>休闲衬衫3</h4>
                    </div>
                    <div class="option" data-value="正装衬衫3">
                        <div class="image">
                            <img src="img/register-step3-6.jpg" />
                            <span class="cover"></span>
                        </div>
                        <h4>正装衬衫3</h4>
                    </div>
                    <div class="option" data-value="休闲衬衫4">
                        <div class="image">
                            <img src="img/register-step3-7.jpg" />
                            <span class="cover"></span>
                        </div>
                        <h4>休闲衬衫4</h4>
                    </div>
                    <div class="option select-all">
                        <div class="image">
                            <img src="img/register-step3-8.jpg" />
                            <span class="cover"></span>
                        </div>
                        <h4>我全部喜欢</h4>
                    </div>
                </div>
            </div>
            <div class="step step4" data-show-info-confirm="true">
                <div class="stepForm">
                    <div class="control-group">
                        <div class="form-control">
                            <input name="firstName" class="input" type="text" placeholder="姓" required />
                            <div class="tooltip">姓错误</div>
                        </div>
                        <div class="form-control">
                            <input name="lastName" class="input" type="text" placeholder="名" required />
                            <div class="tooltip">名错误</div>
                        </div>
                    </div>
                    <div class="form-control">
                        <input name="email" class="input" type="text" placeholder="邮件地址" required />
                        <div class="tooltip">邮件地址错误</div>
                    </div>
                    <div class="form-control">
                        <input name="tel" class="input" type="text" placeholder="联系电话" required />
                        <div class="tooltip">联系电话错误</div>
                    </div>
                    <div class="control-group">
                        <div class="form-control">
                            <input name="captcha" class="input" type="text" placeholder="验证码" required />
                            <div class="tooltip">验证码错误</div>
                        </div>
                        <div class="form-control">
                            <a class="button btn-captcha" href="javascript:void(0);">获取验证码</a>
                        </div>
                    </div>
                    <div class="form-control">
                        <input name="weichat" class="input" type="text" placeholder="微信" />
                        <div class="tooltip">微信错误</div>
                    </div>
                    <div class="form-control">
                        <input name="refer" class="input" type="text" placeholder="介绍人电子邮箱" />
                        <div class="tooltip">介绍人电子邮箱错误</div>
                    </div>
                    <a href="javascript:void(0);" class="button">下一步</a>
                </div>
            </div>
            <div class="step step5" data-show-info-confirm="true">
                <div class="stepForm">
                    <div class="form-control">
                        <input name="newPassword" class="input" type="password" placeholder="创建新的密码" autocomplete="off" min="6" max="20" required />
                        <div class="tooltip">密码应由6-20位字符组成</div>
                    </div>
                    <div class="form-control">
                        <input name="rePassword" class="input" type="password" placeholder="确认新密码" autocomplete="off" required />
                        <div class="tooltip">确认新密码错误</div>
                    </div>
                    <p class="msg hidden"></p>
                    <a href="javascript:void(0);" class="button">下一步</a>
                </div>
            </div>
            <div class="step step6">
                <div class="options clearfix">
                    <div class="option">
                        <h4>1.在线量体：您可以按照我们提供的视频方式进行量体，引导您正确量体。</h4>
                        <a class="button" href="javascript:void(0);">开始量体</a>
                    </div>
                    <div class="option">
                        <h4>2.欢迎来访！如果您恰好在我们提供上门量体的城市，可与我们预约时间进行量体。</h4>
                        <a class="button" href="javascript:void(0);">联系我们</a>
                    </div>
                    <div class="option">
                        <h4>3.立即购物。您可以选择毛衣、领带或者其它别的物品，马上行动吧。</h4>
                        <a class="button" href="javascript:void(0);">立即购买</a>
                    </div>
                </div>
                <div class="map">
                    <img src="img/register-step6-1.jpg" />
                </div>
            </div>
        </div>
        <a class="next-btn hidden" href="javascript:void(0);">下一步</a>
        <div class="info-confirm hidden">
            <h1>请确认以下信息。</h1>
            <div class="info-container clearfix">
                <div class="info">
                    <h4>我没有时间购物。</h4>
                    <div class="image">
                        <img src="img/register-step1-2.jpg" />
                    </div>
                </div>
                <div class="info">
                    <h4>我对以下这些东西感兴趣。</h4>
                    <div class="images clearfix">
                        <div class="image">
                            <img src="img/register-step3-1.jpg" />
                        </div>
                        <div class="image">
                            <img src="img/register-step3-2.jpg" />
                        </div>
                        <div class="image">
                            <img src="img/register-step3-3.jpg" />
                        </div>
                        <div class="image">
                            <img src="img/register-step3-4.jpg" />
                        </div>
                    </div>
                </div>
                <div class="info">
                    <h4>我通常感觉不合适的地方。</h4>
                    <ul class="radio-info">
                        <li>袖口太紧</li>
                        <li>衣长太短</li>
                        <li>袖长太长</li>
                        <li>袖口太紧</li>
                        <li>衣长太短</li>
                    </ul>
                </div>
            </div>
        </div>
    </div>
    <footer>
        <div class="contact">
            <h3 class="hide-on-small">与凡布保持联系</h3>
            <div class="input-group hide-on-small">
                <input class="input" type="text" placeholder="请输入您的邮件地址" />
                <a href="javascript:void(0);" class="btn">»</a>
            </div>
            <div class="ico-link text-center-on-small">
                <a href="javascript:void(0);"><img src="img/ico-email.jpg" /></a>
                <a href="javascript:void(0);"><img src="img/ico-weibo.png" /></a>
                <a href="javascript:void(0);"><img src="img/ico-weixin.png" /></a>
                <a href="javascript:void(0);"><img src="img/ico-taobao.png" /></a>
            </div>
        </div>
        <div class="links text-center-on-small">
            <div class="row">
                <div class="col-md-3 col-sm-12">
                    <h6>FabriTailor.com</h6>
                    <ul>
                        <li>
                            <a href="javascript:void(0);">
                                北京市<br />
                                朝阳区<br />
                                夏家园18号楼<br />
                                2091室
                            </a>
                        </li>
                    </ul>
                </div>
                <div class="col-md-3 col-sm-12">
                    <h6>凡布制衣</h6>
                    <ul>
                        <li><a href="javascript:void(0);">关于我们</a></li>
                        <li><a href="javascript:void(0);">人才招聘</a></li>
                        <li><a href="javascript:void(0);">成为凡布量体师</a></li>
                        <li><a href="javascript:void(0);">服务条款</a></li>
                        <li><a href="javascript:void(0);">隐私声明</a></li>
                    </ul>
                </div>
                <div class="col-md-3 col-sm-12">
                    <h6>帮助</h6>
                    <ul>
                        <li><a href="javascript:void(0);">购物指南</a></li>
                        <li><a href="javascript:void(0);">关于量体定制</a></li>
                        <li><a href="javascript:void(0);">常见问题解答</a></li>
                        <li><a href="javascript:void(0);">帮助与支持</a></li>
                        <li><a href="javascript:void(0);">退换货信息</a></li>
                    </ul>
                </div>
                <div class="col-md-3 col-sm-12">
                    <h6>在线商店</h6>
                    <ul>
                        <li><a href="javascript:void(0);">衬衫</a></li>
                        <li><a href="javascript:void(0);">查看全部</a></li>
                    </ul>
                </div>
            </div>
        </div>
        <div class="logo">
            <img src="img/logo-footer.png" />
        </div>
    </footer>
    <div class="login-panel">
        <h2>登录</h2>
        <input class="input" type="text" placeholder="请输入电子邮件地址" />
        <input class="input" type="password" placeholder="请输入密码" />
        <a class="button" href="javascript:void(0);">登陆</a>
        <a href="javascript:void(0);">忘记密码，或立即免费注册成为会员？</a>
    </div>
    <div class="cover-small-black"></div>
    <div class="login-cover-black"></div>
    <script type="text/javascript">
        //侧边栏
        $("header .menu-btn").click(function () {
            $("aside").addClass("opened");
            $("div.cover-small-black").addClass("opened").fadeTo("normal", 0.5, EASING_NAME);
        });
        $("aside .btn-close").click(function () {
            $("aside").removeClass("opened");
            $("div.cover-small-black").fadeTo("normal", 0, EASING_NAME, function () { $(this).removeClass("opened"); });
        });
        //登陆
        var showLogin = function () {
            $(".login-panel").show();
            $("div.login-cover-black").addClass("opened").fadeTo("normal", 0.5, EASING_NAME);
        };
        var hideLogin = function () {
            $(".login-panel").hide();
            $("div.login-cover-black").fadeTo("normal", 0, EASING_NAME, function () { $(this).removeClass("opened"); });
        };
        $("div.login-cover-black").click(hideLogin);
        $("header .btn-group .login").click(showLogin);
    </script>
    <script type="text/javascript">
        var $h1 = $(".main-container > h1"),
            $p = $(".main-container > p"),
            $ol = $(".main-container > ol"),
            $steps = $(".main-container .steps"),
            $btnNext = $(".main-container .next-btn"),
            $infoConfirm = $(".main-container .info-confirm"),
            $step4Form = $steps.children(".step.step4").children(".stepForm"),
            $step5Form = $steps.children(".step.step5").children(".stepForm"),
            $firstName = $step4Form.find("input[name=firstName]"),
            $lastName = $step4Form.find("input[name=lastName]"),
            $email = $step4Form.find("input[name=email]"),
            $tel = $step4Form.find("input[name=tel]"),
            $captcha = $step4Form.find("input[name=captcha]"),
            $weichat = $step4Form.find("input[name=weichat]"),
            $refer = $step4Form.find("input[name=refer]"),
            $newPassword = $step5Form.find("input[name=newPassword]"),
            $rePassword = $step5Form.find("input[name=rePassword]");
        var showStep = function (index) {
            if (typeof index !== "number")
                index = parseInt(index, 10);
            if (index >= $steps.children(".step").length
                || $steps.children(".step.active").length && index == $steps.children(".step.active").prevAll().length
                || (index > 0 && !$steps.children(".step").eq(index - 1).hasClass("selected"))
                || $steps.hasClass("loading")) {
                return;
            }
            var $step = $steps.children(".step").eq(index);
            $steps.children(".step.active").removeClass("active").fadeTo("normal", 0, EASING_NAME, function () { $(this).hide(); });
            $steps.addClass("loading").children(".step").eq(index).addClass("active").fadeTo("slow", 1, EASING_NAME, function () {
                $steps.removeClass("loading");
            });
            $steps.animate({ height: $step.outerHeight() }, "slow", EASING_NAME);
            $ol.children("li").removeClass("active").eq(index).addClass("active");
            if ($step.data("show-next-btn")) {
                $btnNext.removeClass("hidden");
            }
            else {
                $btnNext.addClass("hidden");
            }
            if ($step.data("show-info-confirm")) {
                $infoConfirm.removeClass("hidden");
            }
            else {
                $infoConfirm.addClass("hidden");
            }
        };
        var nextBtnClick = function () {
            showStep($steps.children(".step.active").prevAll().length + 1);
        };
        var step1BtnClick = function () {
            var $option = $(this).parent(),
                $step = $option.parent().parent();
            $step.find(".options .option").removeClass("active").find("a").removeClass("active");
            $option.addClass("active").children("a").addClass("active");
            $step.addClass("selected");
            $infoConfirm.find(".info-container .info").eq(0).children("h4").text($option.children("h1").text());
            $infoConfirm.find(".info-container .info").eq(0).find(".image img").attr("src", $option.find(".image img").attr("src"));
            showStep($step.prevAll().length + 1);
        };
        var step2RadioClick = function () {
            var $radio = $(this).parent(),
                $option = $radio.parent(),
                $step = $option.parent().parent().parent();
            $step.find(".option-none input").get(0).checked = false;
            $step.addClass("selected");
            step2SetSummaryValue();
        };
        var step2ResetRadioClick = function () {
            var $step = $(this).parent().parent().parent().parent();
            $step.find(".options .option input").each(function (i, e) {
                e.checked = false;
            });
            $step.addClass("selected");
            step2SetSummaryValue();
        };
        var step2SetSummaryValue = function () {
            var $step = $steps.children(".step").eq(1),
                $ul = $infoConfirm.find(".info-container .info").eq(2).children("ul.radio-info");
            if ($step.find(".option-none input:checked").length) {
                $ul.children("li").remove().end().append("<li>无</li>");
            }
            else {
                $ul.children("li").remove();
                $step.find(".options .option input:checked").each(function (i, e) {
                    var $radio = $(e).parent(),
                        $option = $radio.parent();
                    $ul.append("<li>" + $option.data("name") + $radio.children("h4").text() + "</li>");
                });
            }
        };
        var step3OptionImageClick = function () {
            var $option = $(this).parent(),
                $step = $option.parent().parent();
            $option.toggleClass("active");
            if ($step.find(".options .option.active").not(".select-all").length == $step.find(".options .option").not(".select-all").length) {
                $step.find(".options .option.select-all").addClass("active");
            }
            else {
                $step.find(".options .option.select-all").removeClass("active");
            }
            if ($step.find(".options .option.active").length) {
                $step.addClass("selected");
            }
            else {
                $step.removeClass("selected");
            }
            step3SetSummaryValue();
        };
        var step3OptionSelectAll = function () {
            var $option = $(this).parent(),
                $step = $option.parent().parent();
            if ($step.find(".options .option.active").not(".select-all").length >= $step.find(".options .option").not($option).length) {
                $step.removeClass("selected").find(".options .option.active").removeClass("active");
            }
            else {
                $step.addClass("selected").find(".options .option").addClass("active");
            }
            step3SetSummaryValue();
        };
        var step3SetSummaryValue = function () {
            var $step = $steps.children(".step").eq(2),
                $images = $infoConfirm.find(".info-container .info").eq(1).children(".images");
            $images.children().remove();
            $step.find(".options .option.active").not(".select-all").each(function (i, e) {
                var $option = $(e),
                    $image = $('<div class="image"><img /></div>');
                $image.children("img").attr("src", $option.find(".image img").attr("src"));
                $images.append($image);
            });
        };
        var step4CaptchaTimer = null;
        var step4CaptchaBtnClick = function () {
            if ($(this).hasClass("disabled"))
                return;
            if (!$tel.val() || $tel.val().length == 0) {
                $tel.parent().addClass("has-error");
                return;
            }
            var $this = $(this);
            $.ajax({
                url: "${base}/common/captchasms.jhtml",
                type: "GET",
                data: { captchaId: $tel.val() },
                dataType: "json",
                cache: false,
                traditional: true,
                success: function (data) { },
                error: function () { }
            }).always(function () {
                $this.addClass("disabled").data("timeout", 60);
                $this.text(60);
                step4CaptchaTimer = setInterval(function () {
                    var timeout = parseInt($this.data("timeout")) - 1;
                    if (timeout <= 0) {
                        $this.removeClass("disabled").text("获取验证码");
                        clearInterval(step4CaptchaTimer);
                    }
                    else {
                        $this.data("timeout", timeout);
                        $this.text(timeout);
                    }
                }, 1000);
            });
        };
        var step4BtnClick = function () {
            var $stepForm = $(this).parent(),
                $step = $stepForm.parent(),
                hasError = 0;
            $stepForm.find(".form-control input").each(function (i, e) {
                var $this = $(this),
                    $control = $this.parent();
                if ($this.prop("required") && (!$this.val() || $this.val().length == 0)) {
                    $control.addClass("has-error");
                    hasError++;
                }
                else {
                    $control.removeClass("has-error");
                }
            });
            if (hasError == 0) {
                $step.addClass("selected");
                showStep($step.prevAll().length + 1);
            }
            else {
                $step.removeClass("selected");
            }
        };
        var step5BtnClick = function () {
            if ($(this).hasClass("disabled"))
                return;
            var $stepForm = $(this).parent(),
                $step = $stepForm.parent(),
                hasError = 0;
            $stepForm.children("p.msg").addClass("hidden");
            $stepForm.find(".form-control input").each(function (i, e) {
                var $this = $(this),
                    $control = $this.parent();
                if ($this.prop("required") && (!$this.val() || $this.val().length == 0)) {
                    $control.addClass("has-error");
                    hasError++;
                }
                else if ($this.attr("min") && $this.val() && $this.val().length < parseInt($this.attr("min"))) {
                    $control.addClass("has-error");
                    hasError++;
                }
                else if ($this.attr("max") && $this.val() && $this.val().length > parseInt($this.attr("max"))) {
                    $control.addClass("has-error");
                    hasError++;
                }
                else {
                    $control.removeClass("has-error");
                }
            });
            if ($newPassword.prop("required") && $newPassword.val() != $rePassword.val()) {
                $rePassword.parent().addClass("has-error");
                hasError++;
            }
            if (hasError == 0) {
                //获取调查问卷信息
                var questionArr = [], optionArr = [], answerArr = [];
                $steps.children(".step1, .step2, .step3").each(function (i, e) {
                    var $step = $(e),
                        option = [],
                        answer = [];
                    questionArr.push($step.data("name") || "无");
                    if ($step.is(".step2")) {
                        $step.find(".options .option").each(function (j, el) {
                            var $option = $(el);
                            if ($option.data("name")) {
                                option.push($option.data("name"));
                                if ($option.find("input:checked").length) {
                                    answer.push($option.data("name") + $option.find("input:checked").parent().children("h4").text());
                                }
                            }
                        });
                    }
                    else {
                        $step.find(".options .option").each(function (j, el) {
                            var $option = $(el);
                            if ($option.data("value")) {
                                option.push($option.data("value"));
                                if ($option.hasClass("active")) {
                                    answer.push($option.data("value"));
                                }
                            }
                        });
                    }
                    optionArr.push(option.length ? option.join(",") : "无");
                    answerArr.push(answer.length ? answer.join(",") : "无");
                });
                //提交注册信息
                $stepForm.children("a.button").addClass("disabled");
                $.ajax({
                    url: "${base}/common/public_key.jhtml",
                    type: "GET",
                    dataType: "json",
                    cache: false,
                    success: function (data) {
                        var params = {
                            captchaId: $tel.val(),
                            captcha: $captcha.val(),
                            username: $tel.val(),
                            email: $email.val(),
                            memberAttribute_1: $firstName.val() + $lastName.val(),
                            memberAttribute_11: $firstName.val(),
                            memberAttribute_12: $lastName.val(),
                            question: questionArr,
                            option: optionArr,
                            answer: answerArr
                        };
                        var rsaKey = new RSAKey();
                        rsaKey.setPublic(b64tohex(data.modulus), b64tohex(data.exponent));
                        params.enPassword = hex2b64(rsaKey.encrypt($newPassword.val()));
                        if ($weichat.val() && $weichat.val().length) {
                            params.memberAttribute_9 = $weichat.val();
                        }
                        if ($refer.val() && $refer.val().length) {
                            params.memberAttribute_10 = $refer.val();
                        }
                        $.ajax({
                            url: "${base}/register/submitv2.jhtml",
                            type: "POST",
                            data: params,
                            dataType: "json",
                            cache: false,
                            traditional: true,
                            success: function (data) {
                                if (data && data.type == "success") {
                                    $step.addClass("selected");
                                    showStep($step.prevAll().length + 1);
                                }
                                else {
                                    $stepForm.children("p.msg").removeClass("hidden").text("注册失败。" + (data && data.content ? data.content : ""));
                                }
                            },
                            error: function () {
                                $stepForm.children("p.msg").removeClass("hidden").text("注册失败。");
                            }
                        }).always(function () {
                            $stepForm.children("a.button").removeClass("disabled");
                        });
                    }
                }).fail(function () {
                    $stepForm.children("p.msg").removeClass("hidden").text("注册失败。");
                    $stepForm.children("a.button").removeClass("disabled");
                });
            }
            else {
                $step.removeClass("selected");
            }
        };
        var step4InputChange = function () {
            var $this = $(this),
                $control = $this.parent(),
                $step = $control.parentsUntil(".step").last().parent();
            if ($this.attr("required") && (!$this.val() || $this.val().length == 0) && $step.hasClass("selected")) {
                $control.addClass("has-error");
                $step.removeClass("selected");
            }
        };
        $steps.children(".step").eq(0).find(".options .option").on("click", "div.image,a", step1BtnClick);
        $steps.children(".step").eq(1).find(".options .option input").click(step2RadioClick);
        $steps.children(".step").eq(1).find(".option-none input").click(step2ResetRadioClick);
        $steps.children(".step").eq(2).find(".options .option:not(.select-all) .image").click(step3OptionImageClick);
        $steps.children(".step").eq(2).find(".options .option.select-all .image").click(step3OptionSelectAll);
        $steps.children(".step").eq(3).find(".stepForm .form-control input").change(step4InputChange);
        $steps.children(".step").eq(3).find(".stepForm a.btn-captcha").click(step4CaptchaBtnClick);
        $steps.children(".step").eq(3).find(".stepForm a.button").not(".btn-captcha").click(step4BtnClick);
        $steps.children(".step").eq(4).find(".stepForm .form-control input").change(step4InputChange);
        $steps.children(".step").eq(4).find(".stepForm a.button").click(step5BtnClick);
        $btnNext.click(nextBtnClick);
        $ol.find("li a").click(function () {
            showStep($(this).parent().prevAll().length);
        });
        $(window).resize(function () {
            if ($steps.children(".step.active").length) {
                $steps.height($steps.children(".step.active").first().outerHeight());
            }
        });
        showStep(0);
    </script>
</body>
</html>
