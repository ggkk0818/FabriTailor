<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
    <meta name="viewport" content="user-scalable=no, initial-scale=1, maximum-scale=1, minimum-scale=1, width=device-width, height=device-height" />
    <meta name="apple-mobile-web-app-capable" content="yes">
    <title>FabriTailor</title>
    <link href="css/animate.css" rel="stylesheet" />
    <link href="css/style.css" rel="stylesheet" />
    <link href="css/index.css" rel="stylesheet" />
    <script src="js/modernizr.js"></script>
    <script src="js/jquery-1.11.3.min.js"></script>
    <script src="js/jquery.easing.1.3.js"></script>
    <script src="js/jquery.alert.js"></script>
    <script src="js/jquery.cookie.js"></script>
    <script src="js/jquery.lazyload.js"></script>
    <script src="js/jquery.zeroclipboard.min.js"></script>
    <script src="js/common.js"></script>
</head>
<body>
    <header>
        <div class="header-container">
            <a class="menu-btn show-on-small" href="javascript:void(0);"><img src="img/menu-btn.png" /></a>
            <div class="logo">
                <a href="index.html"><img src="img/logo.png" /></a>
            </div>
            <nav class="hide-on-small">
                <ul>
                    <li><a href="javascript:void(0);"><span>在线定制</span></a></li>
                    <li><a href="javascript:void(0);"><span>关于我们</span></a></li>
                    <li><a href="javascript:void(0);"><span>凡布风尚</span></a></li>
                    <li><a href="javascript:void(0);"><span>休闲衬衫</span></a></li>
                    <li><a href="javascript:void(0);"><span>正装衬衫</span></a></li>
                </ul>
            </nav>
            <div class="btn-group hide-on-small">
                <a href="javascript:void(0);" class="register">从这里开始</a>
                <a href="javascript:void(0);" class="login">登录</a>
                <a href="javascript:void(0);" class="cart hidden">购物车</a>
                <div class="account hidden">
                    <span>&nbsp;</span>
                    <div class="dropdown-menu">
                        <ul>
                            <li><a href="javascript:void(0);">账号</a></li>
                            <li><a href="javascript:void(0);">登出</a></li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
    </header>
    <aside class="show-on-small">
        <a href="javascript:void(0);" class="btn-close"><img src="img/menu-btn-close.png" /></a>
        <ul>
            <li><a href="javascript:void(0);"><span>首页</span></a></li>
            <li><a href="javascript:void(0);"><span>在线定制</span></a></li>
            <li class="login"><a href="javascript:void(0);"><span>登录</span></a></li>
            <li class="logout hidden"><a href="javascript:void(0);"><span>登出</span></a></li>
            <li><a href="javascript:void(0);"><span>关于我们</span></a></li>
            <li><a href="javascript:void(0);"><span>凡布风尚</span></a></li>
            <li><a href="javascript:void(0);"><span>休闲衬衫</span></a></li>
            <li><a href="javascript:void(0);"><span>我们的凡布</span></a></li>
            <li class="account hidden">
                <a href="javascript:void(0);"><span>我的账号</span><i class="showhide"></i></a>
                <div class="sub-menu fadeInDownFast clearfix">
                    <a href="${base}/member/index.jhtml">账户信息</a>
                    <a href="${base}/member/order/list.jhtml">我的订单</a>
                    <a href="${base}/member/size/list.jhtml">我的尺寸</a>
                    <a href="${base}/member/specification/list.jhtml">我的板型</a>
                    <a href="${base}/member/receiver/list.jhtml">地址簿</a>
                    <a href="javascript:void(0);">退换货</a>
                </div>
            </li>
            <li class="register"><a class="button" href="javascript:void(0);">从这里开始</a></li>
        </ul>
    </aside>
    <div class="main-container">
        <section class="index-image-container large">
            <img src="img/lazyload.png" data-src="img/index1.jpg" />
            <div class="text">
                <h2>制作属于你的衬衫</h2>
                <h3>一流面料配合精良工艺<br />上门量体打造完美合体的衬衫</h3>
                <a href="javascript:void(0);" class="button-hollow hide-on-small">从这里开始</a>
            </div>
        </section>
        <section class="index-text-container">
            我们的服务是这样的
        </section>
        <section class="index-image-container">
            <!--<img src="img/index2.jpg" style="width:100%;" />-->
            <video poster="video/poster.jpg" width="100%" autoplay loop muted>
                <source src="video/index-video.mp4" type="video/mp4">
                <source src="video/index-video.webm" type="video/webm">
                <source src="video/index-video.ogv" type="video/ogv">
                <source src="video/index-video.mpg" type="video/mpg">
            </video>
        </section>
        <section class="index-text-container">
            <ol>
                <li>在线上或者电话与穿衣顾问约定量体时间</li>
                <li>我们的穿衣顾问会上门为你量体，12个工作日制作完成后送衣服给你试穿。</li>
                <li>以后再次购买只需在线点击完成，足不出户就可以再次买到合身的衬衫。</li>
            </ol>
        </section>
        <hr />
        <section class="index-text-container">
            <h2>卓越品质，精确匹配</h2>
        </section>
        <section class="index-image-container medium">
            <img src="img/lazyload.png" data-src="img/index3.jpg" />
        </section>
        <section class="index-text-container">
            <ol>
                <li>我们的设计师会为你亲手挑选世界各地的布料，并为你设计专属的颜色和图案。</li>
                <li>每一颗纽扣、每一块衬布、每一组缝线都精益求精。</li>
                <li>我们通过上千件衬衫的拆解与研究，找到了真正适合亚洲人身材的衬衫剪裁，<br />并且通过量体师与互联网的组合，让任何人都可以拥有完美合体的衬衫。</li>
                <li>最高品质的原料、精湛的工艺、个性化的服务，打造一件真正属于你的衬衫。</li>
            </ol>
        </section>
        <hr />
        <section class="index-text-container">
            <h2>拥有自己的私人穿衣顾问</h2>
        </section>
        <section class="index-image-container medium">
            <img src="img/lazyload.png" data-src="img/index4.jpg" />
        </section>
        <section class="index-text-container">
            <p>做时尚达人并不容易。但有了凡布，你毫不费力就可以打造一件有品味并合身的衬衫。量身过程轻松，简单，并只需要30分钟。<a class="underline" href="javascript:void(0);">了解更多</a>。</p>
        </section>
        <hr />
        <section class="index-text-container">
            <h2>简单轻松的在线定制流程</h2>
        </section>
        <section class="index-image-container medium">
            <img src="img/lazyload.png" data-src="img/index5.jpg" />
        </section>
        <section class="index-text-container">
            <p>自信起源于此。专属于你的尺寸，简单的在线购物体验，随时随地为你服务的穿衣顾问。</p>
        </section>
        <section class="index-image-container medium">
            <img src="img/lazyload.png" data-src="img/index6.jpg" />
            <div class="text" style="height: 200px;margin-top:-50px;">
                <h3>量体裁衣 只为懂得品质的你</h3>
                <a href="javascript:void(0);" class="button-hollow hide-on-small" style="margin-top:60px;">从这里开始</a>
            </div>
        </section>
    </div>
    <footer>
        <div class="contact">
            <h3 class="text-center-on-small hidden">邀请朋友购买双方各获得100元代金券</h3>
            <div class="input-group hidden">
                <input class="input" type="text" value="h2q6dh1" />
                <a id="invitationCodeCopyBtn" class="btn" href="javascript:void(0);" data-refer-code="h2q6dh1">复制</a>
                <div class="tip hidden">已复制到剪贴板</div>
            </div>
            <img class="qr-img" src="img/qr-img.png" />
            <div class="ico-link text-center-on-small hidden">
                <a href="javascript:void(0);"><img src="img/ico-email.jpg" /></a>
                <a href="javascript:void(0);"><img src="img/ico-weibo.png" /></a>
                <a href="javascript:void(0);"><img src="img/ico-weixin.png" /></a>
                <a href="javascript:void(0);"><img src="img/ico-taobao.png" /></a>
            </div>
        </div>
        <div class="links text-center-on-small">
            <div class="row">
                <div class="col-md-3 col-sm-12">
                    <h6>FabriTailor.com</h6>
                    <ul>
                        <li>
                            <a href="javascript:void(0);">
                                北京市<br />
                                朝阳区<br />
                                夏家园18号楼<br />
                                2091室
                            </a>
                        </li>
                    </ul>
                </div>
                <div class="col-md-3 col-sm-12">
                    <h6>凡布制衣</h6>
                    <ul>
                        <li><a href="javascript:void(0);">关于我们</a></li>
                        <li><a href="javascript:void(0);">人才招聘</a></li>
                        <li><a href="javascript:void(0);">成为凡布量体师</a></li>
                        <li><a href="javascript:void(0);">服务条款</a></li>
                        <li><a href="javascript:void(0);">隐私声明</a></li>
                    </ul>
                </div>
                <div class="col-md-3 col-sm-12">
                    <h6>帮助</h6>
                    <ul>
                        <li><a href="javascript:void(0);">购物指南</a></li>
                        <li><a href="javascript:void(0);">关于量体定制</a></li>
                        <li><a href="javascript:void(0);">常见问题解答</a></li>
                        <li><a href="javascript:void(0);">帮助与支持</a></li>
                        <li><a href="javascript:void(0);">退换货信息</a></li>
                    </ul>
                </div>
                <div class="col-md-3 col-sm-12">
                    <h6>在线商店</h6>
                    <ul>
                        <li><a href="javascript:void(0);">衬衫</a></li>
                        <li><a href="javascript:void(0);">查看全部</a></li>
                    </ul>
                </div>
            </div>
        </div>
        <div class="logo">
            <img src="img/logo-footer.png" />
        </div>
    </footer>
    <div class="login-panel">
        <h2>登录</h2>
        <input class="input" type="text" placeholder="请输入电子邮件地址" />
        <input class="input" type="password" placeholder="请输入密码" />
        <p class="hidden"></p>
        <a class="button" href="javascript:void(0);">登陆</a>
        <a href="javascript:void(0);">忘记密码，或立即免费注册成为会员？</a>
    </div>
    <div class="cover-small-black"></div>
    <div class="login-cover-black"></div>
    <script type="text/javascript">
        //侧边栏
        $("header .menu-btn").click(function () {
            $("aside").addClass("opened");
            $("div.cover-small-black").addClass("opened").fadeTo("normal", 0.5, EASING_NAME);
        });
        $("aside .btn-close").click(function () {
            $("aside").removeClass("opened");
            $("div.cover-small-black").fadeTo("normal", 0, EASING_NAME, function () { $(this).removeClass("opened"); });
        });
        var asideSubMenuInit = function (el) {
            var $li = $(el),
                $a = $li.children("a"),
                $subMenu = $li.children(".sub-menu");
            $a.click(function (e) {
                e.preventDefault();
                $a.next().toggleClass("opened").end().children("i.showhide").toggleClass("mins");
            });
        };
        asideSubMenuInit($("body > aside ul li.account"));
    </script>
    <script src="js/jsbn.js"></script>
    <script src="js/base64.js"></script>
    <script src="js/prng4.js"></script>
    <script src="js/rng.js"></script>
    <script src="js/rsa.js"></script>
    <script type="text/javascript">
        $("footer .contact").children(".qr-img").addClass("hidden").end().children("h3, .input-group").removeClass("hidden").children("input.input").val("test");
        $("footer .contact #invitationCodeCopyBtn").data("refer-code", "test").on({
            "beforecopy": function () {
                $(this).prev(".input").get(0).select();
            },
            "copy": function (e) {
                e.clipboardData.clearData();
                e.clipboardData.setData("text/plain", $(this).data("refer-code"));
                e.preventDefault();
            },
            "aftercopy": function () {
                $(this).next(".tip").stop(true, true).css({ opacity: 1 }).removeClass("hidden").delay(3000).fadeTo("normal", 0, function () { $(this).addClass("hidden"); });
            }
        });
        //这里应该用cookie中是否有username来判断是否已登录,memberUsername是用于记住曾经登录的用户名(记住我)
        //if ($.cookie("memberUsername")) {
        if ($.cookie("name")) {
            //用户信息链接
            $("header .btn-group .account .dropdown-menu a").click(function (e) {
                e.stopPropagation();
            });
            $("header .btn-group .account").click(function (e) {
                window.location.href = "${base}/member/index.jhtml";
            });
            $("header .btn-group").children(".register, .login").addClass("hidden");
            $("header .btn-group").children(".cart, .account").removeClass("hidden");
            //这里应该用cookie中是否有username来判断是否已登录,memberUsername是用于记住曾经登录的用户名(记住我)
            //$("header .btn-group .account").removeClass("hidden").children("span").text($.cookie("memberUsername"));
            $("header .btn-group .account").children("span").text($.cookie("name"));
            //侧边栏链接
            $("body > aside ul li").filter(".login, .register").addClass("hidden").end().filter(".logout, .cart, .account").removeClass("hidden");
            //获取购物车商品数量
            $.ajax({
                url: "${base}/cart/count.jhtml",
                type: "GET",
                dataType: "json",
                cache: false,
                success: function (data) {
                    if (data && data.message && data.message.type == "success") {
                        if (data.quantity) {
                            $("header .btn-group").children(".cart").text("购物车(" + data.quantity + ")");
                            $("body > aside ul li.cart").children("a").text("购物车(" + data.quantity + ")");
                        }
                    }
                }
            });
            //获取邀请码
            $.ajax({
                url: "${base}/member/invitationCode.jhtml",
                type: "GET",
                dataType: "json",
                cache: false,
                success: function (data) {
                    if (data && data.message && data.message.type == "success") {
                        $("footer .contact").children(".qr-img").addClass("hidden").end().children("h3, .input-group").removeClass("hidden").children("input.input").val(data.invitationCode);
                        $("footer .contact #invitationCodeCopyBtn").data("refer-code", data.invitationCode).on({
                            "beforecopy": function () {
                                $(this).prev(".input").get(0).select();
                            },
                            "copy": function (e) {
                                e.clipboardData.clearData();
                                e.clipboardData.setData("text/plain", $(this).data("refer-code"));
                                e.preventDefault();
                            },
                            "aftercopy": function () {
                                $(this).next(".tip").stop(true, true).css({ opacity: 1 }).removeClass("hidden").delay(3000).fadeTo("normal", 0, function () { $(this).addClass("hidden"); });
                            }
                        });
                    }
                }
            });
        }
        else {
            //登陆
            var $loginPanel = $(".login-panel"),
                $loginCover = $("div.login-cover-black");
            var showLogin = function () {
                $loginPanel.show();
                $loginCover.addClass("opened").fadeTo("normal", 0.5, EASING_NAME);
            };
            var hideLogin = function () {
                $loginPanel.hide();
                $loginCover.fadeTo("normal", 0, EASING_NAME, function () { $(this).removeClass("opened"); });
            };
            var doLogin = function () {
                if ($loginPanel.children("a.button").hasClass("disabled"))
                    return;
                $loginPanel.children("p").addClass("hidden");
                var $username = $loginPanel.children("input").eq(0),
                    $password = $loginPanel.children("input").eq(1);
                if (!$username.val() || !$username.val().length) {
                    $username.addClass("has-error");
                }
                else {
                    $username.removeClass("has-error");
                }
                if (!$password.val() || !$password.val().length) {
                    $password.addClass("has-error");
                }
                else {
                    $password.removeClass("has-error");
                }
                if ($loginPanel.children(".has-error").length)
                    return;
                $loginPanel.children("a.button").addClass("disabled");
                $.getJSON("${base}/common/public_key.jhtml", function (data) {
                    var rsaKey = new RSAKey();
                    rsaKey.setPublic(b64tohex(data.modulus), b64tohex(data.exponent));
                    var enPassword = hex2b64(rsaKey.encrypt($password.val()));
                    $.ajax({
                        url: "${base}/login/submit.jhtml",
                        type: "POST",
                        data: {
                            username: $username.val(),
                            enPassword: enPassword
                        },
                        dataType: "json",
                        cache: false,
                        success: function (data) {
                            if (data && data.type == "success") {
                                $.cookie("memberUsername", $username.val(), { expires: 7 * 24 * 60 * 60 });
                                //[#if redirectUrl??]
                                window.location.href = "${redirectUrl}";
                                //[#else]
                                window.location.reload();
                                //[/#if]
                            }
                            else {
                                $loginPanel.children("p").removeClass("hidden").text("登录失败。" + data.content);
                            }
                        },
                        error: function () {
                            $loginPanel.children("p").removeClass("hidden").text("登录失败");
                        }
                    }).always(function () {
                        $loginPanel.children("a.button").removeClass("disabled");
                    });
                }).fail(function () {
                    $loginPanel.children("p").removeClass("hidden").text("获取登录凭证失败");
                    $loginPanel.children("a.button").removeClass("disabled");
                });
            };
            $("div.login-cover-black").click(hideLogin);
            $("header .btn-group .login").click(showLogin);
            $(".login-panel a.button").click(doLogin);
            $loginPanel.find("input").keypress(function (e) {
                if (e && e.keyCode == 13) {
                    doLogin.call($loginPanel.children("a.button").get(0));
                }
            });
        }
    </script>
    <script type="text/javascript">
        //分屏加载
        $(".index-image-container > img[data-src]").lazyload({
            failurelimit: 10,
            data_attribute: "src",
            load: function (elements_left, settings, img) {
                var width = img ? img.width : this.width,
                    height = img ? img.height : this.height;
                $(this).data("origin-width", width);
                $(this).data("origin-height", height);
                $(this).css({
                    //marginTop: -(height / 2),
                    marginLeft: -(width / 2)
                }).parent().animate({ opacity: 1 }, 1000, EASING_NAME).removeClass("loading");
                $(window).trigger("resize.index-image-container");
            }
        }).each(function (i, e) {
            $(this).parent().animate({ opacity: 0 }, 0).addClass("loading");
        });
        $(window).on("resize.index-image-container", function () {
            $(".index-image-container > img").each(function (i, e) {
                var $img = $(e);
                if ($img.css("marginLeft") && $img.data("origin-width") && $img.data("origin-height")) {
                    $img.css({ marginLeft: -($img.data("origin-width") * $img.height() / $img.data("origin-height") / 2) });
                }
            });
        });
    </script>
    <script type="text/javascript">
        if ($.cookie("name")) {
            window.location.href = "/login/welcome.jhtml";
        }
    </script>
</body>
</html>
