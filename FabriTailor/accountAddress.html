<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta name="viewport" content="user-scalable=no, initial-scale=1, maximum-scale=1, minimum-scale=1, width=device-width, height=device-height" />
    <meta name="apple-mobile-web-app-capable" content="yes">
    <title>地址簿 - FabriTailor</title>
    <link href="css/animate.css" rel="stylesheet" />
    <link href="css/style.css" rel="stylesheet" />
    <link href="css/account.css" rel="stylesheet" />
    <link href="css/accountAddress.css" rel="stylesheet" />
    <script src="js/modernizr.js"></script>
    <script src="js/jquery-1.11.3.min.js"></script>
    <script src="js/jquery.cookie.js"></script>
    <script src="js/jquery.easing.1.3.js"></script>
    <script src="js/jquery.lazyload.js"></script>
    <script src="js/common.js"></script>
</head>
<body>
    <header>
        <div class="header-container">
            <a class="menu-btn show-on-small" href="javascript:void(0);"><img src="img/menu-btn.png" /></a>
            <div class="logo">
                <img src="img/logo.png" />
            </div>
            <nav class="hide-on-small">
                <ul>
                    <li><a href="javascript:void(0);"><span>在线定制</span></a></li>
                    <li><a href="javascript:void(0);"><span>关于我们</span></a></li>
                    <li><a href="javascript:void(0);"><span>凡布风尚</span></a></li>
                    <li><a href="javascript:void(0);"><span>休闲衬衫</span></a></li>
                    <li><a href="javascript:void(0);"><span>我们的凡布</span></a></li>
                </ul>
            </nav>
            <div class="btn-group hide-on-small">
                <a href="javascript:void(0);" class="register">从这里开始</a><a href="javascript:void(0);" class="login">登录</a>
            </div>
        </div>
    </header>
    <aside class="show-on-small">
        <a href="javascript:void(0);" class="btn-close"><img src="img/menu-btn-close.png" /></a>
        <ul>
            <li><a href="javascript:void(0);"><span>在线定制</span></a></li>
            <li><a href="javascript:void(0);"><span>关于我们</span></a></li>
            <li><a href="javascript:void(0);"><span>凡布风尚</span></a></li>
            <li><a href="javascript:void(0);"><span>休闲衬衫</span></a></li>
            <li><a href="javascript:void(0);"><span>我们的凡布</span></a></li>
            <li><a class="button" href="javascript:void(0);">从这里开始</a></li>
        </ul>
    </aside>
    <div class="main-container clearfix">
        <div class="account-aside">
            <div class="current">地址簿<i class="showhide"></i></div>
            <ul>
                <li><a href="javascript:void(0);">账户信息</a></li>
                <li><a href="javascript:void(0);">我的订单</a></li>
                <li><a href="javascript:void(0);">我的尺寸</a></li>
                <li><a href="javascript:void(0);">我的板型</a></li>
                <li><a href="javascript:void(0);">分享与学习</a></li>
                <li class="active"><a href="javascript:void(0);">地址簿</a></li>
                <li><a href="javascript:void(0);">退换货</a></li>
            </ul>
            <a href="javascript:void(0);" class="sign-out">退出</a>
        </div>
        <div class="account-container">
            <div class="accountAddress">
                <h1>地址簿</h1>
                <p>在这里你可以管理你的送货地址。点击地址卡片右下角的编辑按钮可以进行修改和设置默认地址，点击地址卡片右上角可以进行删除。</p>
                <ul class="address-list">
                    <li>
                        <div class="content">
                            <span class="delete-text">删除这个地址？</span>
                            <p>张三</p>
                            <p>13901111111</p>
                            <p>北京 北京市</p>
                            <p>海淀区 学院路1号</p>
                        </div>
                        <div class="sidebar">
                            <a class="btn" href="javascript:void(0);"><img src="img/account-address-del.png" /></a>
                            <a class="btn" href="javascript:void(0);"><img src="img/account-address-edit.png" /></a>
                        </div>
                        <div class="sidebar-confirm">
                            <a class="btn btn-yes" href="javascript:void(0);"><span>是</span></a>
                            <a class="btn btn-no" href="javascript:void(0);"><span>否</span></a>
                        </div>
                    </li>
                    <li data-id="2" data-name="张三" data-province="bj" data-city="北京" data-addr="海淀区 学院路1号" data-tel="13901111111" data-default="true">
                        <div class="content">
                            <span class="delete-text">删除这个地址？</span>
                            <p>张三</p>
                            <p>13901111111</p>
                            <p>北京 北京市</p>
                            <p>海淀区 学院路1号</p>
                        </div>
                        <div class="sidebar">
                            <a class="btn" href="javascript:void(0);"><img src="img/account-address-del.png" /></a>
                            <a class="btn" href="javascript:void(0);"><img src="img/account-address-edit.png" /></a>
                        </div>
                        <div class="sidebar-confirm">
                            <a class="btn btn-yes" href="javascript:void(0);"><span>是</span></a>
                            <a class="btn btn-no" href="javascript:void(0);"><span>否</span></a>
                        </div>
                    </li>
                    <li>
                        <div class="content">
                            <span class="delete-text">删除这个地址？</span>
                            <p>张三</p>
                            <p>13901111111</p>
                            <p>北京 北京市</p>
                            <p>海淀区 学院路1号</p>
                        </div>
                        <div class="sidebar">
                            <a class="btn" href="javascript:void(0);"><img src="img/account-address-del.png" /></a>
                            <a class="btn" href="javascript:void(0);"><img src="img/account-address-edit.png" /></a>
                        </div>
                        <div class="sidebar-confirm">
                            <a class="btn btn-yes" href="javascript:void(0);"><span>是</span></a>
                            <a class="btn btn-no" href="javascript:void(0);"><span>否</span></a>
                        </div>
                    </li>
                </ul>
                <a class="add-address" href="javascript:void(0);"><span>添加新地址</span><i></i></a>
                <div class="detailForm fadeInDownFast">
                    <div class="form-control">
                        <input name="name" class="input" type="text" placeholder="姓名" required />
                        <div class="tooltip">姓名错误</div>
                    </div>
                    <div class="control-group">
                        <div class="form-control" style="width:120px;">
                            <select name="province" class="select" required>
                                <option value="">省市</option>
                            </select>
                            <div class="tooltip">省市错误</div>
                        </div>
                        <div class="form-control" style="width:120px;">
                            <select name="city" class="select" required>
                                <option value="">区县</option>
                            </select>
                            <div class="tooltip">区县错误</div>
                        </div>
                    </div>
                    <div class="form-control">
                        <input name="addr" class="input" type="text" placeholder="地址" required />
                        <div class="tooltip">地址错误</div>
                    </div>
                    <div class="form-control">
                        <input name="tel" class="input" type="text" placeholder="联系电话" required />
                        <div class="tooltip">联系电话错误</div>
                    </div>
                    <div class="form-control">
                        <input name="weichat" class="input" type="text" placeholder="微信" />
                    </div>
                    <div class="checkbox">
                        <input id="accountAddressIsDefault" class="checkbox" type="checkbox" />
                        <label for="accountAddressIsDefault">设为默认</label>
                    </div>
                    <p class="msg hidden"></p>
                    <a href="javascript:void(0);" class="button">保存</a>
                </div>
            </div>
        </div>
    </div>
    <footer>
        <div class="contact">
            <h3 class="hide-on-small">与凡布保持联系</h3>
            <div class="input-group hide-on-small">
                <input class="input" type="text" placeholder="请输入您的邮件地址" />
                <a href="javascript:void(0);" class="btn">»</a>
            </div>
            <div class="ico-link text-center-on-small">
                <a href="javascript:void(0);"><img src="img/ico-email.jpg" /></a>
                <a href="javascript:void(0);"><img src="img/ico-weibo.png" /></a>
                <a href="javascript:void(0);"><img src="img/ico-weixin.png" /></a>
                <a href="javascript:void(0);"><img src="img/ico-taobao.png" /></a>
            </div>
        </div>
        <div class="links text-center-on-small">
            <div class="row">
                <div class="col-md-3 col-sm-12">
                    <h6>FabriTailor.com</h6>
                    <ul>
                        <li>
                            <a href="javascript:void(0);">
                                北京市<br />
                                朝阳区<br />
                                夏家园18号楼<br />
                                2091室
                            </a>
                        </li>
                    </ul>
                </div>
                <div class="col-md-3 col-sm-12">
                    <h6>凡布制衣</h6>
                    <ul>
                        <li><a href="javascript:void(0);">关于我们</a></li>
                        <li><a href="javascript:void(0);">人才招聘</a></li>
                        <li><a href="javascript:void(0);">成为凡布量体师</a></li>
                        <li><a href="javascript:void(0);">服务条款</a></li>
                        <li><a href="javascript:void(0);">隐私声明</a></li>
                    </ul>
                </div>
                <div class="col-md-3 col-sm-12">
                    <h6>帮助</h6>
                    <ul>
                        <li><a href="javascript:void(0);">购物指南</a></li>
                        <li><a href="javascript:void(0);">关于量体定制</a></li>
                        <li><a href="javascript:void(0);">常见问题解答</a></li>
                        <li><a href="javascript:void(0);">帮助与支持</a></li>
                        <li><a href="javascript:void(0);">退换货信息</a></li>
                    </ul>
                </div>
                <div class="col-md-3 col-sm-12">
                    <h6>在线商店</h6>
                    <ul>
                        <li><a href="javascript:void(0);">衬衫</a></li>
                        <li><a href="javascript:void(0);">查看全部</a></li>
                    </ul>
                </div>
            </div>
        </div>
        <div class="logo">
            <img src="img/logo-footer.png" />
        </div>
    </footer>
    <div class="login-panel">
        <h2>登录</h2>
        <input class="input" type="text" placeholder="请输入电子邮件地址" />
        <input class="input" type="password" placeholder="请输入密码" />
        <a class="button" href="javascript:void(0);">登陆</a>
        <a href="javascript:void(0);">忘记密码，或立即免费注册成为会员？</a>
    </div>
    <div class="cover-small-black"></div>
    <div class="login-cover-black"></div>
    <script type="text/javascript">
        //侧边栏
        $("header .menu-btn").click(function () {
            $("aside").addClass("opened");
            $("div.cover-small-black").addClass("opened").fadeTo("normal", 0.5, EASING_NAME);
        });
        $("aside .btn-close").click(function () {
            $("aside").removeClass("opened");
            $("div.cover-small-black").fadeTo("normal", 0, EASING_NAME, function () { $(this).removeClass("opened"); });
        });
        //登陆
        var showLogin = function () {
            $(".login-panel").show();
            $("div.login-cover-black").addClass("opened").fadeTo("normal", 0.5, EASING_NAME);
        };
        var hideLogin = function () {
            $(".login-panel").hide();
            $("div.login-cover-black").fadeTo("normal", 0, EASING_NAME, function () { $(this).removeClass("opened"); });
        };
        $("div.login-cover-black").click(hideLogin);
        $("header .btn-group .login").click(showLogin);
    </script>
    <script type="text/javascript">
        //账号导航菜单
        $(".main-container .account-aside .current").click(function () {
            $(this).children("i.showhide").toggleClass("mins");
            $(".main-container .account-aside ul").toggleClass("opened");
        });
    </script>
    <script type="text/javascript">
        var $addressList = $(".main-container .account-container .accountAddress .address-list"),
            $btnAddAddress = $(".main-container .account-container .accountAddress .add-address"),
            $detailForm = $(".main-container .account-container .accountAddress .detailForm"),
            $name = $detailForm.find("input[name=name]"),
            $province = $detailForm.find("select[name=province]"),
            $city = $detailForm.find("select[name=city]"),
            $addr = $detailForm.find("input[name=addr]"),
            $tel = $detailForm.find("input[name=tel]"),
            $weichat = $detailForm.find("input[name=weichat]"),
            $isDefault = $("#accountAddressIsDefault");
        //获取省市信息
        $.ajax({
            url: "${base}/common/area.jhtml",
            type: "GET",
            dataType: "json",
            cache: false,
            traditional: true,
            success: function (data) {
                if (data) {
                    for (var id in data) {
                        $province.append('<option value="' + id + '">' + data[id] + '</option>');
                    }
                }
            }
        });
        //获取区县信息
        var getCityData = function () {
            $city.children("option").not(":eq(0)").remove();
            if ($province.val() && $province.val().length) {
                $.ajax({
                    url: "${base}/common/area.jhtml",
                    type: "GET",
                    data: { parentId: $province.val() },
                    dataType: "json",
                    cache: false,
                    traditional: true,
                    success: function (data) {
                        if (data) {
                            for (var id in data) {
                                $city.append('<option value="' + id + '">' + data[id] + '</option>');
                            }
                            if ($city.data("value")) {
                                $city.val($city.data("value"));
                                $city.removeData("value");
                            }
                        }
                    }
                });
            }
        };
        var setFormValues = function (address) {
            if (address) {
                var $address = $(address);
                $detailForm.data("id", $address.data("id"));
                $name.val($address.data("name") || "");
                $province.val($address.data("province"));
                $province.change();
                $city.data("value", $address.data("city") || "");
                $addr.val($address.data("addr") || "");
                $tel.val($address.data("tel") || "");
                $isDefault.get(0).checked = $address.data("default") && $address.data("default") == true;
            }
            else {
                $detailForm.removeData("id");
                $name.val("");
                $province.val("");
                $city.val("");
                $addr.val("");
                $tel.val("");
                $isDefault.get(0).checked = false;
            }
        };
        var addAddress = function () {
            if ($btnAddAddress.hasClass("active"))
                setFormValues();
            $btnAddAddress.children("span").text("添加新地址");
            $addressList.toggleClass("hidden");
            $btnAddAddress.toggleClass("active");
            $detailForm.toggleClass("active");
            $detailForm.children("p.msg").addClass("hidden");
        };
        var editAddress = function () {
            $btnAddAddress.children("span").text("编辑地址");
            setFormValues($(this).parent().parent());
            $addressList.addClass("hidden");
            $btnAddAddress.addClass("active");
            $detailForm.addClass("active");
            $detailForm.children("p.msg").addClass("hidden");
        };
        var deleteAddress = function () {
            $(this).parent().parent().addClass("confirm");
        };
        var doDelete = function () {
            var $address = $(this).parent().parent();
            if ($address.data("id")) {
                $.ajax({
                    url: "${base}/member/receiver/delete.jhtml",
                    type: "POST",
                    data: { id: $address.data("id") },
                    dataType: "json",
                    cache: false,
                    traditional: true,
                    success: function (data) {
                        if (data && data.type == "success") {
                            $address.remove();
                        }
                    },
                    error: function () {
                        
                    }
                });
            }
        };
        var cancelDelete = function () {
            $(this).parent().parent().removeClass("confirm");
        };
        var submit = function () {
            if ($(this).hasClass("disabled"))
                return;
            $detailForm.children("p.msg").addClass("hidden");
            //表单验证
            var hasError = 0;
            $detailForm.find(".form-control input, .form-control select").each(function (i, e) {
                var $this = $(this),
                    $control = $this.parent();
                if ($this.prop("required") && (!$this.val() || $this.val().length == 0)) {
                    $control.addClass("has-error");
                    hasError++;
                }
                else {
                    $control.removeClass("has-error");
                }
            });
            if (hasError == 0) {
                var params = {
                    consignee: $name.val(),
                    areaName: $province.children("option:checked").text() + $city.children("option:checked").text(),
                    areaId: $city.val(),
                    address: $addr.val(),
                    phone: $tel.val(),
                    isDefault: $isDefault.get(0).checked
                };
                if ($weichat.val() && $weichat.val().length) {
                    params.weichat = $weichat.val();
                }
                $(this).addClass("disabled");
                if ($detailForm.data("id")) {
                    params.id = $detailForm.data("id");
                    $.ajax({
                        url: "${base}/member/receiver/updatev2.jhtml",
                        type: "POST",
                        data: params,
                        dataType: "json",
                        cache: false,
                        traditional: true,
                        success: function (data) {
                            if (data && data.type == "success") {
                                window.location.reload();
                            }
                            else {
                                $detailForm.children("p.msg").removeClass("hidden").text("保存失败。" + (data && data.content ? data.content : ""));
                            }
                        },
                        error: function () {
                            $detailForm.children("p.msg").removeClass("hidden").text("保存失败。");
                        }
                    }).always(function () {
                        $detailForm.children("a.button").removeClass("disabled");
                    });
                }
                else {
                    $.ajax({
                        url: "${base}/member/receiver/savev2.jhtml",
                        type: "POST",
                        data: params,
                        dataType: "json",
                        cache: false,
                        traditional: true,
                        success: function (data) {
                            if (data && data.type == "success") {
                                window.location.reload();
                            }
                            else {
                                $detailForm.children("p.msg").removeClass("hidden").text("保存失败。" + (data && data.content ? data.content : ""));
                            }
                        },
                        error: function () {
                            $detailForm.children("p.msg").removeClass("hidden").text("保存失败。");
                        }
                    }).always(function () {
                        $detailForm.children("a.button").removeClass("disabled");
                    });
                }
            }
        };
        $addressList.find("li").each(function (i, e) {
            $(e).find(".sidebar a.btn")
                .eq(0).click(deleteAddress).end()
                .eq(1).click(editAddress);
            $(e).find(".sidebar-confirm a.btn")
                .eq(0).click(doDelete).end()
                .eq(1).click(cancelDelete);
        });
        $btnAddAddress.click(addAddress);
        $province.change(getCityData);
        $detailForm.children("a.button").click(submit);
    </script>
</body>
</html>
